{% extends "crud/form.html" %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load common_tags %}

{% block extra_js %}

<script language="Javascript">

  function atualizar_autores() {
    var tipo_autor = $("#id_tipo_autor").val();
    var materia_id = {{ root_pk }};

    // Limpa a listagem para atualizar
    $("#id_autor").find("option").remove();

    $.get("/materia/autoria/atualizar-autores",
        {tipo_autor: tipo_autor, materia_id: materia_id},
        function(data) {
          // Caso não venha nenhum dado da requisição, retorna null
          if ($.isEmptyObject(data)){
            return null
          }

          lista_autores = data['lista_autores'];
          // Atualiza a listagem de autores

          $.each(lista_autores, function(index, obj) {
            $("#id_autor").append($("<option></option>")
                          .attr("value", obj[0])
                          .text(obj[1]));
          });

        });
  }
  $("#id_tipo_autor").change(function () {
        atualizar_autores();
    });
</script>

{% endblock %}
