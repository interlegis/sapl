{% extends "crud/form.html" %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load common_tags %}

{% block extra_js %}

<script language="Javascript">

  function atualizar_autores() {
    var tipo_autor = $("#id_tipo_autor").val();
    var materia_id = {{ root_pk }}

    // Limpa a listagem para atualizar
    $("#id_autor").find("option").remove();

    $.get("/materia/autoria/atualizar-autores",
        {tipo_autor: tipo_autor, materia_id: materia_id},
        function(data) {
          // Caso não venha nenhum dado da requisição, retorna null
          if ($.isEmptyObject(data)){
            return null
          }

          lista_autores = data['lista_autores'];
          // Atualiza a listagem de autores
          for (i = 0; i < lista_autores.length; i++) {
              $('#id_autor').append(
                  '<option value="' + lista_autores[i][0] + '">' +
                  lista_autores[i][1] + '</option>');
          }
        });
  }
  $("#id_tipo_autor").change(function () {
        atualizar_autores();
    });
</script>

{% endblock %}
