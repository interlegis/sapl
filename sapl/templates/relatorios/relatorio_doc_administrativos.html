{% load i18n %}
{% load crispy_forms_tags %}
{% load common_tags %}

<head>
    <style>
        @page{
            margin-top: 4.5cm;
            size: A4 portrait;

            @bottom-right {
                content: "Página" counter(page);
                height: 3cm;
                font-size: 8pt;
            }
        
            @bottom-center {
                border-top: 1px solid black;
                font-size: 8pt;
                height: 1cm;
                content: "{{rodape|safe}}";
                font-style:italic;
            }
            @bottom-left {
                content: "{{data}}";
                height: 3cm;
                font-size: 8pt;
            }
              
            @top-center {
                content:  string(title);
            }
            header {
                width: 0;
                height: 0;
                visibility: hidden;
                string-set: title content();
            }
        }
    </style>
</head>	

<body>
    <table class="table table-striped table-bordered">
          <thead class="thead-default"><tr><td><h3>Resultados</h3></td></tr></thead>
          {% if page_obj|length %}
            {% for d in page_obj %}
              {% if request.user.is_anonymous and not d.restrito or not request.user.is_anonymous%}
              <tr>
                <td>
                  <strong><a href="{% url 'sapl.protocoloadm:documentoadministrativo_detail' d.id %}">{{d.tipo.sigla}} {{d.numero}}/{{d.ano}} - {{d.tipo}}</strong></a></br>
                    <strong>Interessado:</strong>&nbsp;{{ d.interessado|default_if_none:"Não informado"}}
                    </br>
                  <strong>Assunto:</strong>&nbsp;{{ d.assunto|safe }}
                    </br>
                  {% if d.protocolo %}
                    <strong>Protocolo:</strong>&nbsp;<a href="{% url 'sapl.protocoloadm:protocolo_mostrar' d.protocolo.id %}">{{ d.protocolo}}</a></br>
                  {% endif %}
                    {% define d.tramitacaoadministrativo_set.last as tram %}
                    {% if tram.unidade_tramitacao_destino %}
                    <strong>Localização Atual:</strong> &nbsp;{{tram.unidade_tramitacao_destino}}
                        </br>
                       <strong>Status:</strong> {{tram.status}}
                        </br>
                    {% endif %}
                    {% define d.documentoacessorioadministrativo_set.all as acess %}
                    {% if d.documentoacessorioadministrativo_set.all.exists %}
                            <strong>Documentos Acessórios:</strong>
                            <a href="{% url 'sapl.protocoloadm:documentoacessorioadministrativo_list' d.id %}">
                                {{ d.documentoacessorioadministrativo_set.all.count }}
                            </a>
                            </br>
                        {% endif %}
                  {% if d.texto_integral %}
                    <strong><a href="{{ d.texto_integral.url }}">Texto Integral</a></strong></br>
                  {% endif %}
                  {% if d.tramitacao and mail_service_configured %}
                    <a href="{% url 'sapl.protocoloadm:acompanhar_documento' d.id %}">Acompanhar Documento</a>
                  {% endif %}
                </td>

              </tr>
            {% endif %}
            {% endfor %}
          {% else  %}
            <tr><td><h3>Nenhum documento encontrado com essas especificações</h3></tr>
          {% endif %}
    </table>
</body>