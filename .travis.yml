language: python

python:
  - 3.4.3

services:
  - postgresql

install:
  - pip install -r requirements/test-requirements.txt

before_script:
  - npm install -g bower
  - cp sapl/.env_test sapl/.env
  - psql -c "CREATE USER sapl WITH PASSWORD 'sapl'" -U postgres;
  - psql -c "CREATE DATABASE sapl OWNER sapl;" -U postgres

script:
  - ./manage.py migrate
  - ./manage.py bower install
  - py.test --create-db --cov . --cov-report term

addons:
    hosts:
        - 127.0.0.1 sapldb

after_sucess:
  - CODECLIMATE_REPO_TOKEN=4d19e43ef9a92ca21314499fc1cc4e127cc5a4dea7fcc5b8e36e03780ada43c9 codeclimate-test-reporter
